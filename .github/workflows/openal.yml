name: 'OpenAL/GL detection'

on:
  # Pushes to certain branches,
  push:
    branches: [osx-openal]

env:
  HOMEBREW_CACHE: "${{ github.workspace }}/.brew_cache"

jobs:

  compose:
    name: build and cache homebrew
    runs-on: macos-latest

    steps:

      #- name: Clear homebrew cache
      #  run: |
      #    rm -r ~/Library/Caches/Homebrew

      - name: Fetch dependencies from homebrew
        run: |
          brew install mesa

      - name: List cache
        run: ls .brew_cache/*_bottle_manifest--*

      #- name: Calculate a hash
      #  id: hash
      #  run: |
      #    hash=`cat ~/Library/Caches/Homebrew/downloads/*bottle_manifest.json | md5sum - | cut -d' ' -f1`
      #    echo ::set-output name=hash::$hash

      - name: Test hash
        run: |
          echo ${{ hashFiles('.brew_cache/downloads/*bottle_manifest.json') }}

      #- name: Create/Access Cache
      #  id: cache
      #  uses: actions/cache@v2
      #  with:
      #    path: ~/Library/Caches/Homebrew
      #    key: ${{ runner.os }}-homebrew_cache-${{ steps.hash.hash }}

      - name: Checkout repository
        if: always()
        uses: actions/checkout@v2
        with:
          fetch-depth: 1
          submodules: false

      - name: Find with CMake
        if: always()
        run: find/script.sh
